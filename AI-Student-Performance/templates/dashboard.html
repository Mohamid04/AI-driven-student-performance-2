<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AI Student Performance</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .navbar {
            background: white;
            padding: 15px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
            backdrop-filter: blur(10px);
        }

        .navbar h1 {
            color: #333;
            font-size: 28px;
            font-weight: 700;
        }

        .navbar-links {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .navbar-links a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .navbar-links a:hover {
            background: #f0f0f0;
            color: #764ba2;
            transform: translateY(-2px);
        }

        .navbar-links .logout {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .navbar-links .logout:hover {
            box-shadow: 0 5px 20px rgba(220, 53, 69, 0.4);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 18px;
            padding: 60px 20px;
        }

        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease-out;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        /* Profile Card Styles */
        .profile-card {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 30px;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            z-index: 0;
        }

        .profile-card::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            z-index: 0;
        }

        .profile-card > * {
            position: relative;
            z-index: 1;
        }

        .profile-image {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .profile-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .info-value {
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .stat-box:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Activities Section */
        .activities-section {
            margin-top: 20px;
        }

        .activities-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 12px;
            display: block;
            letter-spacing: 1px;
        }

        .activity-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        .activity-badge:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.05);
        }

        .marks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .mark-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 5px solid #667eea;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .mark-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .mark-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .mark-item:hover::before {
            opacity: 1;
        }

        .mark-item h3 {
            color: #333;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .mark-item .value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            position: relative;
            z-index: 1;
        }

        .mark-item .max {
            color: #999;
            font-size: 12px;
            margin-top: 8px;
            position: relative;
            z-index: 1;
        }

        .performance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .summary-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .summary-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .summary-item h4 {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-item .value {
            font-size: 28px;
            font-weight: 700;
            color: white;
        }

        .feedback-card {
            grid-column: 1 / -1;
            border-left: 5px solid;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }

        .feedback-card h2 {
            margin-bottom: 20px;
        }

        .feedback-message {
            font-size: 22px;
            font-weight: 600;
            margin: 20px 0;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .feedback-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            pointer-events: none;
        }

        .feedback-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feedback-detail {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
        }

        .feedback-detail:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .feedback-detail h4 {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feedback-detail .value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        /* Chart Container */
        .chart-container {
            grid-column: 1 / -1;
            position: relative;
            height: 450px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-container h2 {
            margin-bottom: 25px;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        /* Comparison Card */
        .comparison-card {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .comparison-card h2 {
            color: white;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .comparison-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
        }

        .comparison-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        .comparison-value {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .comparison-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .comparison-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 16px;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                text-align: center;
            }

            .navbar-links {
                width: 100%;
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .profile-card {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .profile-image {
                margin: 0 auto;
                width: 140px;
                height: 140px;
            }

            .profile-info {
                grid-template-columns: 1fr;
            }

            .profile-stats {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 350px;
            }

            .mark-item .value {
                font-size: 24px;
            }

            .summary-item .value {
                font-size: 22px;
            }
        }

        .admin-link {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .admin-link:hover {
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }

        /* Achievement Badge */
        .achievement-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
        }

        .achievement-section h2 {
            color: #333;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-badge {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border: 2px solid #ffd700;
        }

        .achievement-badge:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .achievement-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>üéì Student Dashboard</h1>
        <div class="navbar-links">
            <a href="/admin" class="admin-link"><i class="fas fa-chart-bar"></i> Admin Panel</a>
            <a href="/logout" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>

    <div class="container">
        <div id="loading" class="loading">
            <span class="spinner"></span>Loading your performance data...
        </div>

        <div id="content" style="display: none;">
            <div class="dashboard-grid">
                <!-- Profile Card -->
                <div class="card profile-card">
                    <img id="profileImage" src="" alt="Profile" class="profile-image">
                    <div>
                        <h2 style="grid-column: 1 / -1; margin-bottom: 15px; color: white;">üë§ Student Profile</h2>
                        <div class="profile-info">
                            <div class="info-item">
                                <div class="info-label">Name</div>
                                <div class="info-value" id="studentName">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Email</div>
                                <div class="info-value" id="studentEmail">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Branch</div>
                                <div class="info-value" id="studentBranch">-</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Roll No.</div>
                                <div class="info-value" id="studentRollNo">-</div>
                            </div>
                        </div>
                        <div class="activities-section">
                            <span class="activities-label">üéØ Activities</span>
                            <div id="activitiesContainer"></div>
                        </div>
                    </div>
                    <div class="profile-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="studentAttendance">-</div>
                            <div class="stat-label">Attendance</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="studentRank">-</div>
                            <div class="stat-label">Rank</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="totalMarksDisplay">-</div>
                            <div class="stat-label">Total Marks</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="percentageDisplay">-</div>
                            <div class="stat-label">Percentage</div>
                        </div>
                    </div>
                </div>

                <!-- Marks Card -->
                <div class="card">
                    <h2><i class="fas fa-book"></i> Subject-wise Marks</h2>
                    <div class="marks-grid">
                        <div class="mark-item">
                            <h3>üìê Maths</h3>
                            <div class="value" id="mathsMarks">-</div>
                            <div class="max">out of 100</div>
                        </div>
                        <div class="mark-item">
                            <h3>üî¨ Science</h3>
                            <div class="value" id="scienceMarks">-</div>
                            <div class="max">out of 100</div>
                        </div>
                        <div class="mark-item">
                            <h3>üìñ English</h3>
                            <div class="value" id="englishMarks">-</div>
                            <div class="max">out of 100</div>
                        </div>
                    </div>
                </div>

                <!-- Performance Card -->
                <div class="card">
                    <h2><i class="fas fa-trophy"></i> Performance Summary</h2>
                    <div class="performance-summary">
                        <div class="summary-item">
                            <h4>Total Marks</h4>
                            <div class="value" id="totalMarks">-</div>
                            <small style="color: rgba(255, 255, 255, 0.7);">out of 300</small>
                        </div>
                        <div class="summary-item">
                            <h4>Percentage</h4>
                            <div class="value" id="percentage">-</div>
                        </div>
                        <div class="summary-item">
                            <h4>Grade</h4>
                            <div class="value" id="grade">-</div>
                        </div>
                        <div class="summary-item">
                            <h4>Status</h4>
                            <div class="value" id="status">-</div>
                        </div>
                    </div>
                </div>

                <!-- AI Feedback Card -->
                <div class="card feedback-card" id="feedbackCard">
                    <h2><i class="fas fa-robot"></i> AI-Generated Feedback</h2>
                    <div class="feedback-message" id="feedbackMessage" style="background: #f0f0f0; color: #333;">
                        Loading feedback...
                    </div>
                    <div class="feedback-details">
                        <div class="feedback-detail">
                            <h4>Performance Level</h4>
                            <div class="value" id="feedbackLevel">-</div>
                        </div>
                        <div class="feedback-detail">
                            <h4>Percentile</h4>
                            <div class="value" id="percentile">-</div>
                        </div>
                        <div class="feedback-detail">
                            <h4>Total Students</h4>
                            <div class="value" id="totalStudents">-</div>
                        </div>
                        <div class="feedback-detail">
                            <h4>Improvement Area</h4>
                            <div class="value" id="improvementArea">-</div>
                        </div>
                    </div>
                </div>

                <!-- Performance Chart -->
                <div class="chart-container">
                    <h2><i class="fas fa-chart-radar"></i> Performance Overview</h2>
                    <canvas id="performanceChart"></canvas>
                </div>

                <!-- Comparison Card -->
                <div class="card comparison-card">
                    <h2><i class="fas fa-chart-line"></i> Your Performance</h2>
                    <div class="comparison-grid">
                        <div class="comparison-item">
                            <div class="comparison-label">Your Maths</div>
                            <div class="comparison-value" id="compMaths">-</div>
                            <div class="comparison-bar">
                                <div class="comparison-bar-fill" id="compMathsBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">Your Science</div>
                            <div class="comparison-value" id="compScience">-</div>
                            <div class="comparison-bar">
                                <div class="comparison-bar-fill" id="compScienceBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">Your English</div>
                            <div class="comparison-value" id="compEnglish">-</div>
                            <div class="comparison-bar">
                                <div class="comparison-bar-fill" id="compEnglishBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">Your Overall</div>
                            <div class="comparison-value" id="compOverall">-</div>
                            <div class="comparison-bar">
                                <div class="comparison-bar-fill" id="compOverallBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Card -->
                <div class="card achievement-section">
                    <h2><i class="fas fa-star"></i> Achievements & Badges</h2>
                    <div class="achievement-grid" id="achievementsContainer"></div>
                </div>
            </div>
        </div>

        <div id="error" style="display: none;">
            <div class="error">
                <p>Unable to load your performance data. Please try logging in again.</p>
                <a href="/logout" style="color: #721c24; text-decoration: underline; margin-top: 10px; display: inline-block;">Back to Login</a>
            </div>
        </div>
    </div>

    <script>
        let performanceChart = null;

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const sessionResponse = await fetch('/api/session-check');
                const sessionData = await sessionResponse.json();
                
                if (!sessionData.logged_in) {
                    window.location.href = '/login';
                    return;
                }
            } catch (error) {
                console.error('Error checking session:', error);
            }
            
            loadStudentData();
        });

        async function loadStudentData() {
            try {
                const response = await fetch('/api/student-data');
                const result = await response.json();

                if (response.ok && result.success) {
                    displayStudentData(result.data);
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showError();
            }
        }

        function displayStudentData(data) {
            // Profile Info
            document.getElementById('profileImage').src = data.image_url;
            document.getElementById('studentName').textContent = data.name;
            document.getElementById('studentEmail').textContent = data.email;
            document.getElementById('studentBranch').textContent = data.branch;
            document.getElementById('studentRollNo').textContent = data.roll_no;
            document.getElementById('studentAttendance').textContent = data.attendance + '%';
            document.getElementById('studentRank').textContent = `#${data.rank}`;

            // Activities
            const activitiesContainer = document.getElementById('activitiesContainer');
            activitiesContainer.innerHTML = '';
            if (data.activities && data.activities.length > 0) {
                data.activities.forEach(activity => {
                    const badge = document.createElement('span');
                    badge.className = 'activity-badge';
                    badge.textContent = activity.trim();
                    activitiesContainer.appendChild(badge);
                });
            } else {
                activitiesContainer.innerHTML = '<span style="color: rgba(255, 255, 255, 0.7);">No activities yet</span>';
            }

            // Marks
            document.getElementById('mathsMarks').textContent = data.maths;
            document.getElementById('scienceMarks').textContent = data.science;
            document.getElementById('englishMarks').textContent = data.english;

            // Performance
            document.getElementById('totalMarks').textContent = data.total;
            document.getElementById('totalMarksDisplay').textContent = data.total;
            
            const percentage = Math.round((data.total / 300) * 100);
            document.getElementById('percentage').textContent = percentage + '%';
            document.getElementById('percentageDisplay').textContent = percentage + '%';
            
            let grade = 'F';
            let status = '‚ùå Needs Work';
            if (percentage >= 90) {
                grade = 'A+';
                status = '‚≠ê Excellent';
            } else if (percentage >= 80) {
                grade = 'A';
                status = '‚úÖ Very Good';
            } else if (percentage >= 70) {
                grade = 'B';
                status = 'üëç Good';
            } else if (percentage >= 60) {
                grade = 'C';
                status = 'üìà Average';
            } else if (percentage >= 50) {
                grade = 'D';
                status = '‚ö†Ô∏è Below Average';
            }
            document.getElementById('grade').textContent = grade;
            document.getElementById('status').textContent = status;

            // Feedback
            const feedback = data.feedback;
            const feedbackCard = document.getElementById('feedbackCard');
            feedbackCard.style.borderLeftColor = feedback.color;

            const feedbackMessage = document.getElementById('feedbackMessage');
            feedbackMessage.textContent = feedback.message;
            feedbackMessage.style.background = feedback.color;
            feedbackMessage.style.color = 'white';

            document.getElementById('feedbackLevel').textContent = feedback.level;

            const percentile = Math.round(((data.total_students - data.rank + 1) / data.total_students) * 100);
            document.getElementById('percentile').textContent = `Top ${percentile}%`;
            document.getElementById('totalStudents').textContent = data.total_students;

            const scores = [data.maths, data.science, data.english];
            const subjects = ['Maths', 'Science', 'English'];
            const minScore = Math.min(...scores);
            const minIndex = scores.indexOf(minScore);
            document.getElementById('improvementArea').textContent = subjects[minIndex];

            // Comparison data
            document.getElementById('compMaths').textContent = data.maths;
            document.getElementById('compScience').textContent = data.science;
            document.getElementById('compEnglish').textContent = data.english;
            document.getElementById('compOverall').textContent = percentage + '%';

            document.getElementById('compMathsBar').style.width = data.maths + '%';
            document.getElementById('compScienceBar').style.width = data.science + '%';
            document.getElementById('compEnglishBar').style.width = data.english + '%';
            document.getElementById('compOverallBar').style.width = percentage + '%';

            // Achievements
            generateAchievements(data, percentage);

            // Create chart
            createPerformanceChart(data);

            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function generateAchievements(data, percentage) {
            const achievements = [];

            if (data.attendance >= 95) achievements.push({ icon: 'üìö', name: 'Perfect Attendance' });
            if (data.attendance >= 90) achievements.push({ icon: '‚úÖ', name: 'Great Attendance' });
            if (data.maths >= 90) achievements.push({ icon: 'üßÆ', name: 'Math Master' });
            if (data.science >= 90) achievements.push({ icon: 'üî¨', name: 'Science Expert' });
            if (data.english >= 90) achievements.push({ icon: 'üìñ', name: 'English Scholar' });
            if (percentage >= 90) achievements.push({ icon: 'üèÜ', name: 'Top Performer' });
            if (percentage >= 80) achievements.push({ icon: '‚≠ê', name: 'High Achiever' });
            if (data.activities && data.activities.length >= 2) achievements.push({ icon: 'üéØ', name: 'Active Member' });
            if (data.rank === 1) achievements.push({ icon: 'üëë', name: 'Rank 1' });
            if (data.rank <= 5) achievements.push({ icon: 'ü•á', name: 'Top 5' });

            const container = document.getElementById('achievementsContainer');
            container.innerHTML = '';

            if (achievements.length === 0) {
                container.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #666;">Keep working to earn badges!</p>';
            } else {
                achievements.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = 'achievement-badge';
                    badge.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                    `;
                    container.appendChild(badge);
                });
            }
        }

        function createPerformanceChart(data) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (performanceChart) {
                performanceChart.destroy();
            }

            performanceChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Maths', 'Science', 'English', 'Attendance', 'Overall'],
                    datasets: [
                        {
                            label: 'Your Performance',
                            data: [
                                data.maths,
                                data.science,
                                data.english,
                                data.attendance,
                                Math.round((data.total / 300) * 100)
                            ],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.25)',
                            borderWidth: 3,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 14, weight: 'bold' },
                                color: '#333'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: { size: 12 },
                                color: '#999'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
    </script>
</body>
</html>
